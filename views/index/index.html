{{template "index/header.html" .}}
{{$requestURL := .RequestURI}}
	<div class="container">

      <table class="table table-hover">
        <thead>
          <tr>
            <th width="200">dirName</th>
            <th>mode</th>
            <th>user</th>
            <th>size(M)</th>
            <th>time</th>
            <th>action</th>
          </tr>
        </thead>
        <tbody>
          <tr class="">
            <td style="color:#5555ff;"><a href="{{.parentPath}}">..</a></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>
              <a href="" onclick="mkdir();return false;">mkdir</a>
              <a href="" onclick="createFile();return false;">createFile</a>
            </td>
          </tr>
         
          {{range $key, $value := .dirs}}
          <tr class="">
            <td style="color:#5555ff;"><a href="{{$requestURL}}{{$value.Fname}}">{{$value.Fname}}</a></td>
            
            <td>{{$value.Fmode}}</td>
            <td>{{$value.Funame}}:{{$value.Fgname}}</td>
            <td>{{$value.Fsize}}</td>
            <td>{{$value.Ftime}}</td>
            <td><a>delete</a></td>
          </tr>
          {{end}}
        </tbody>
        <thead>
          <tr>
            <th width="200">fileName</th>
            <th>mode</th>
            <th>user</th>
            <th>size(M)</th>
            <th>time</th>
            <th>action</th>
          </tr>
        </thead>
        <tbody>
          {{range $key, $value := .files}}
          <tr class="">
            <td style="">{{$value.Fname}}</td>
            <td>{{$value.Fmode}}</td>
            <td>{{$value.Funame}}:{{$value.Fgname}}</td>
            <td>{{$value.Fsize}}</td>
            <td>{{$value.Ftime}}</td>
            <td>
              <a href="/operation?action=read&file={{$requestURL}}{{$value.Fname}}" >read</a>
              <a href="" onclick="rename('{{$value.Fname}}');return false;">rename</a>
              <a href="" onclick="deleteFile('{{$value.Fname}}');return false;">delete</a>
              </td>
          </tr>
          {{end}}
        </tbody>
      </table>
  </div>
<script>
function mkdir() {

    var dirname = prompt("Enter dirname ", "");//将输入的内容赋给变量 name ，

    //这里需要注意的是，prompt有两个参数，前面是提示的话，后面是当对话框出来后，在对话框里的默认值

    if(dirname) {
        $.ajax({
            url: "/operation",
            type: "get",
//            contentType: "text/html; charset=utf-8",
            dataType: "json",
            data: {action:"mkdir", dirname: "{{$requestURL}}" + dirname},
            success: function(json){
              if(json[0] == '0') {
                  window.location.href = location.href
              } else {
                  alert(json[1]);
              }
            }
        });
     }

    return ;
}

function createFile() {

    var filename = prompt("Enter filename ", "");//将输入的内容赋给变量 name ，

    //这里需要注意的是，prompt有两个参数，前面是提示的话，后面是当对话框出来后，在对话框里的默认值

    if(filename) {
        $.ajax({
            url: "/operation",
            type: "get",
//            contentType: "text/html; charset=utf-8",
            dataType: "json",
            data: {action:"create", filename: "{{$requestURL}}" + filename},
            success: function(json){
              if(json[0] == '0') {
                  window.location.href = location.href
              } else {
                  alert(json[1]);
              }
            }
        });
     }

    return ;
}

function rename(filename) {

    var newname = prompt("Enter newname ", "");//将输入的内容赋给变量 name ，

    //这里需要注意的是，prompt有两个参数，前面是提示的话，后面是当对话框出来后，在对话框里的默认值

    if(newname) {
        $.ajax({
            url: "/operation",
            type: "get",
//            contentType: "text/html; charset=utf-8",
            dataType: "json",
            data: {action:"rename", oldname: "{{$requestURL}}" + filename,  newname: "{{$requestURL}}" + newname},
            success: function(json){
              if(json[0] == '0') {
                  window.location.href = location.href
              } else {
                  alert(json[1]);
              }
            }
        });
     }

    return ;
}

function deleteFile(filename) {
    if (confirm("Are you sure delete " + filename + " ? ")) {  
        $.ajax({
            url: "/operation",
            type: "get",
//            contentType: "text/html; charset=utf-8",
            dataType: "json",
            data: {action:"delete", file: "{{$requestURL}}" + filename},
            success: function(json){
              if(json[0] == '0') {
                  window.location.href = location.href
              } else {
                  alert(json[1]);
              }
            }
        });
    }
    return ;
}
</script>
{{template "index/footer.html"}}
